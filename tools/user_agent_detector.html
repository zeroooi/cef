<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User-Agentæ£€æµ‹æ–¹å¼åˆ†æå·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .result-item {
            background: #f9f9f9;
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #4CAF50;
            border-radius: 4px;
        }
        .result-label {
            font-weight: bold;
            color: #555;
        }
        .result-value {
            font-family: monospace;
            background: #e8e8e8;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 10px;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        .success {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        .danger {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .code-block {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” User-Agentæ£€æµ‹æ–¹å¼åˆ†æå·¥å…·</h1>
        <p>æ­¤å·¥å…·å¸®åŠ©æ‚¨åˆ†æç›®æ ‡ç½‘ç«™ä½¿ç”¨å“ªç§æ–¹å¼æ£€æµ‹User-Agent</p>
        
        <div class="section">
            <button onclick="detectCurrentSite()">åˆ†æå½“å‰ç½‘ç«™</button>
            <button onclick="testUserAgentMethods()">æµ‹è¯•æ‰€æœ‰æ£€æµ‹æ–¹æ³•</button>
            <button onclick="simulateUserAgentChange()">æ¨¡æ‹ŸUser-Agentæ›´æ”¹</button>
        </div>
    </div>

    <div class="container section">
        <h2>ğŸ“Š æ£€æµ‹ç»“æœ</h2>
        <div id="detection-results"></div>
    </div>

    <div class="container section">
        <h2>ğŸ“‹ å½“å‰ç¯å¢ƒä¿¡æ¯</h2>
        <div id="environment-info"></div>
    </div>

    <div class="container section">
        <h2>ğŸ§ª ç½‘ç»œè¯·æ±‚æ£€æµ‹</h2>
        <div id="network-analysis"></div>
    </div>

    <div class="container section">
        <h2>ğŸ“– åˆ†æå»ºè®®</h2>
        <div id="recommendations"></div>
    </div>

    <script>
        // å½“å‰é¡µé¢çš„User-Agentæ£€æµ‹åˆ†æ
        function detectCurrentSite() {
            const results = document.getElementById('detection-results');
            results.innerHTML = '<p>ğŸ” æ­£åœ¨åˆ†æå½“å‰ç½‘ç«™...</p>';
            
            setTimeout(() => {
                const analysis = analyzeUserAgentDetection();
                displayResults(analysis);
            }, 1000);
        }

        // åˆ†æç½‘ç«™çš„User-Agentæ£€æµ‹æ–¹å¼
        function analyzeUserAgentDetection() {
            const analysis = {
                javascript_detection: false,
                http_header_detection: false,
                fingerprinting_scripts: [],
                detection_methods: [],
                risk_level: 'low'
            };

            // æ£€æµ‹JavaScriptæ–¹å¼
            if (typeof navigator !== 'undefined' && navigator.userAgent) {
                analysis.javascript_detection = true;
                analysis.detection_methods.push('JavaScript navigator.userAgent');
            }

            // æ£€æµ‹é¡µé¢ä¸­çš„User-Agentç›¸å…³ä»£ç 
            const pageContent = document.documentElement.outerHTML;
            const patterns = [
                /navigator\.userAgent/gi,
                /userAgent/gi,
                /User-Agent/gi,
                /browser.*detect/gi,
                /fingerprint/gi,
                /clientHints/gi
            ];

            patterns.forEach((pattern, index) => {
                const matches = pageContent.match(pattern);
                if (matches && matches.length > 0) {
                    const patternNames = [
                        'navigator.userAgentè°ƒç”¨',
                        'userAgentå˜é‡ä½¿ç”¨',
                        'User-Agentå­—ç¬¦ä¸²æ£€æµ‹',
                        'æµè§ˆå™¨æ£€æµ‹è„šæœ¬',
                        'æŒ‡çº¹è¯†åˆ«ä»£ç ',
                        'Client Hints API'
                    ];
                    analysis.fingerprinting_scripts.push({
                        type: patternNames[index],
                        count: matches.length
                    });
                }
            });

            // æ£€æµ‹æ˜¯å¦æœ‰ç¬¬ä¸‰æ–¹æŒ‡çº¹è¯†åˆ«æœåŠ¡
            const thirdPartyServices = [
                'fingerprintjs',
                'deviceatlas',
                'maxmind',
                'browserhawk',
                'amplitude',
                'mixpanel'
            ];

            thirdPartyServices.forEach(service => {
                if (pageContent.toLowerCase().includes(service)) {
                    analysis.fingerprinting_scripts.push({
                        type: 'ç¬¬ä¸‰æ–¹æœåŠ¡: ' + service,
                        count: 1
                    });
                }
            });

            // è®¡ç®—é£é™©ç­‰çº§
            const totalDetections = analysis.fingerprinting_scripts.length;
            if (totalDetections > 5) {
                analysis.risk_level = 'high';
            } else if (totalDetections > 2) {
                analysis.risk_level = 'medium';
            }

            return analysis;
        }

        // æ˜¾ç¤ºæ£€æµ‹ç»“æœ
        function displayResults(analysis) {
            const results = document.getElementById('detection-results');
            let html = '';

            // JavaScriptæ£€æµ‹
            html += `<div class="result-item ${analysis.javascript_detection ? 'success' : 'warning'}">
                <span class="result-label">JavaScriptæ£€æµ‹:</span>
                <span class="result-value">${analysis.javascript_detection ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}</span>
            </div>`;

            // æ£€æµ‹åˆ°çš„è„šæœ¬
            if (analysis.fingerprinting_scripts.length > 0) {
                html += '<div class="result-item danger">';
                html += '<span class="result-label">æ£€æµ‹åˆ°çš„æŒ‡çº¹è¯†åˆ«ä»£ç :</span><br>';
                analysis.fingerprinting_scripts.forEach(script => {
                    html += `<div style="margin-left: 20px;">â€¢ ${script.type}: ${script.count}å¤„</div>`;
                });
                html += '</div>';
            }

            // é£é™©ç­‰çº§
            const riskClass = analysis.risk_level === 'high' ? 'danger' : 
                            analysis.risk_level === 'medium' ? 'warning' : 'success';
            const riskText = analysis.risk_level === 'high' ? 'ğŸ”´ é«˜é£é™©' :
                           analysis.risk_level === 'medium' ? 'ğŸŸ¡ ä¸­ç­‰é£é™©' : 'ğŸŸ¢ ä½é£é™©';
            
            html += `<div class="result-item ${riskClass}">
                <span class="result-label">æŒ‡çº¹è¯†åˆ«é£é™©ç­‰çº§:</span>
                <span class="result-value">${riskText}</span>
            </div>`;

            results.innerHTML = html;

            // ç”Ÿæˆå»ºè®®
            generateRecommendations(analysis);
        }

        // ç”Ÿæˆé’ˆå¯¹æ€§å»ºè®®
        function generateRecommendations(analysis) {
            const recommendations = document.getElementById('recommendations');
            let html = '';

            if (analysis.risk_level === 'high') {
                html += `<div class="result-item danger">
                    <strong>âš ï¸ é«˜é£é™©ç½‘ç«™æ£€æµ‹å»ºè®®ï¼š</strong><br>
                    â€¢ è¯¥ç½‘ç«™ä½¿ç”¨äº†å¤šç§æŒ‡çº¹è¯†åˆ«æŠ€æœ¯<br>
                    â€¢ å»ºè®®åŒæ—¶ä¼ªè£…HTTPå’ŒJavaScript User-Agent<br>
                    â€¢ éœ€è¦ä½¿ç”¨å®Œæ•´çš„æŒ‡çº¹ä¼ªè£…æ–¹æ¡ˆ<br>
                    â€¢ è€ƒè™‘ä½¿ç”¨ä»£ç†æˆ–VPNå¢åŠ ä¿æŠ¤
                </div>`;
            } else if (analysis.risk_level === 'medium') {
                html += `<div class="result-item warning">
                    <strong>âš ï¸ ä¸­ç­‰é£é™©ç½‘ç«™æ£€æµ‹å»ºè®®ï¼š</strong><br>
                    â€¢ ä¸»è¦å…³æ³¨JavaScript User-Agentä¼ªè£…<br>
                    â€¢ å¯èƒ½éœ€è¦é¢å¤–çš„æµè§ˆå™¨æŒ‡çº¹ä¼ªè£…<br>
                    â€¢ å»ºè®®æµ‹è¯•ä¼ªè£…æ•ˆæœ
                </div>`;
            } else {
                html += `<div class="result-item success">
                    <strong>âœ… ä½é£é™©ç½‘ç«™æ£€æµ‹å»ºè®®ï¼š</strong><br>
                    â€¢ JavaScript User-Agentä¼ªè£…é€šå¸¸è¶³å¤Ÿ<br>
                    â€¢ åŸºç¡€æŒ‡çº¹ä¼ªè£…å³å¯æ»¡è¶³éœ€æ±‚<br>
                    â€¢ å®šæœŸéªŒè¯ä¼ªè£…æ•ˆæœ
                </div>`;
            }

            // é’ˆå¯¹æ£€æµ‹åˆ°çš„å…·ä½“æŠ€æœ¯ç»™å‡ºå»ºè®®
            if (analysis.fingerprinting_scripts.some(s => s.type.includes('fingerprintjs'))) {
                html += `<div class="result-item danger">
                    <strong>ğŸ¯ FingerprintJSæ£€æµ‹åˆ°ï¼š</strong><br>
                    â€¢ è¿™æ˜¯ä¸“ä¸šçš„æŒ‡çº¹è¯†åˆ«åº“<br>
                    â€¢ éœ€è¦å®Œæ•´çš„Canvasã€WebGLã€éŸ³é¢‘æŒ‡çº¹ä¼ªè£…<br>
                    â€¢ å»ºè®®ä½¿ç”¨æ‚¨çš„CEFåº”ç”¨çš„å®Œæ•´ä¼ªè£…æ–¹æ¡ˆ
                </div>`;
            }

            recommendations.innerHTML = html;
        }

        // æµ‹è¯•æ‰€æœ‰User-Agentæ£€æµ‹æ–¹æ³•
        function testUserAgentMethods() {
            const results = document.getElementById('environment-info');
            
            const info = {
                'JavaScript User-Agent': navigator.userAgent,
                'æµè§ˆå™¨åç§°': navigator.appName,
                'æµè§ˆå™¨ç‰ˆæœ¬': navigator.appVersion,
                'å¹³å°ä¿¡æ¯': navigator.platform,
                'è¯­è¨€è®¾ç½®': navigator.language,
                'è¯­è¨€åˆ—è¡¨': navigator.languages ? navigator.languages.join(', ') : 'ä¸æ”¯æŒ',
                'Cookieæ”¯æŒ': navigator.cookieEnabled,
                'åœ¨çº¿çŠ¶æ€': navigator.onLine,
                'å±å¹•åˆ†è¾¨ç‡': `${screen.width}x${screen.height}`,
                'é¢œè‰²æ·±åº¦': screen.colorDepth,
                'è®¾å¤‡åƒç´ æ¯”': window.devicePixelRatio,
                'æ—¶åŒºåç§»': new Date().getTimezoneOffset(),
                'å½“å‰æ—¶åŒº': Intl.DateTimeFormat().resolvedOptions().timeZone
            };

            let html = '';
            Object.entries(info).forEach(([key, value]) => {
                html += `<div class="result-item">
                    <span class="result-label">${key}:</span>
                    <span class="result-value">${value}</span>
                </div>`;
            });

            results.innerHTML = html;
        }

        // æ¨¡æ‹ŸUser-Agentæ›´æ”¹æµ‹è¯•
        function simulateUserAgentChange() {
            const network = document.getElementById('network-analysis');
            
            // åˆ›å»ºæµ‹è¯•è¯·æ±‚
            network.innerHTML = '<p>ğŸ” æ­£åœ¨æµ‹è¯•ç½‘ç»œè¯·æ±‚ä¸­çš„User-Agent...</p>';
            
            // æµ‹è¯•XMLHttpRequest
            setTimeout(() => {
                testNetworkRequests();
            }, 1000);
        }

        // æµ‹è¯•ç½‘ç»œè¯·æ±‚
        function testNetworkRequests() {
            const network = document.getElementById('network-analysis');
            let html = '';

            // æµ‹è¯•Fetch API
            html += `<div class="result-item">
                <span class="result-label">æµ‹è¯•è¯´æ˜:</span><br>
                <div class="code-block">
1. HTTP User-Agent: ç”±æµè§ˆå™¨å†…æ ¸è‡ªåŠ¨å‘é€ï¼Œåœ¨ç½‘ç»œè¯·æ±‚å¤´ä¸­
2. JavaScript User-Agent: é€šè¿‡navigator.userAgentè·å–
3. æœåŠ¡ç«¯æ£€æµ‹: åˆ†ææœåŠ¡å™¨æ—¥å¿—æˆ–å“åº”å¤´
4. å®¢æˆ·ç«¯æ£€æµ‹: é€šè¿‡JavaScriptä»£ç æ£€æµ‹
                </div>
            </div>`;

            html += `<div class="result-item warning">
                <span class="result-label">æ£€æµ‹å»ºè®®:</span><br>
                â€¢ ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networkæ ‡ç­¾æŸ¥çœ‹è¯·æ±‚å¤´<br>
                â€¢ åœ¨Consoleä¸­è¿è¡Œ: <code>navigator.userAgent</code><br>
                â€¢ å¯¹æ¯”ä¸¤è€…æ˜¯å¦ä¸€è‡´<br>
                â€¢ æ£€æŸ¥ç½‘ç«™æ˜¯å¦æœ‰æœåŠ¡ç«¯User-AgentéªŒè¯
            </div>`;

            network.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ
        window.addEventListener('DOMContentLoaded', function() {
            testUserAgentMethods();
            
            // æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
            const recommendations = document.getElementById('recommendations');
            recommendations.innerHTML = `
                <div class="result-item">
                    <strong>ğŸ“– å·¥å…·ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                    1. ç‚¹å‡»"åˆ†æå½“å‰ç½‘ç«™"æ£€æµ‹å½“å‰é¡µé¢çš„User-Agentä½¿ç”¨æƒ…å†µ<br>
                    2. ç‚¹å‡»"æµ‹è¯•æ‰€æœ‰æ£€æµ‹æ–¹æ³•"æŸ¥çœ‹å½“å‰ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯<br>
                    3. ç‚¹å‡»"æ¨¡æ‹ŸUser-Agentæ›´æ”¹"äº†è§£ç½‘ç»œè¯·æ±‚æ£€æµ‹åŸç†<br>
                    4. æ ¹æ®æ£€æµ‹ç»“æœè°ƒæ•´æ‚¨çš„CEFåº”ç”¨ä¼ªè£…ç­–ç•¥
                </div>
            `;
        });
    </script>
</body>
</html>